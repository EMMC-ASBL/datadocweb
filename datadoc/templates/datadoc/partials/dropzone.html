<style>
  .dropzone {
    width: 800px;
    height: 250px;
    border: 4px groove #aca7a7;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 50px auto;
    padding: 20px;
    text-align: center;
    color: #888;
    background-color: #ffffff;
    transition: background-color 0.3s, border-color 0.3s;
  }

  .dropzone.dragover {
    border-color: #6d6969;
    background-color: #9b9999;
  }

  #upload-result {
    text-align: center;
    margin-top: 20px;
    color: #888;
  }
</style>

<form id="upload-form" hx-post="{% url 'upload_files' %}" hx-target="#upload-result" hx-swap="innerHTML"
  hx-push-url="false" enctype="multipart/form-data" method="POST">
  {% csrf_token %}
  <div id="drop-zone" class="dropzone">
    <h1><i class="bi bi-upload"></i></h1>
    <p>Drop files here or click to upload</p>
    <input type="file" name="files" id="file-input" hidden onchange="this.form.requestSubmit()">
  </div>
</form>

<div id="upload-result"></div>

<div id="modal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="modal-message"></p>
        <p id="modal-status"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const uploadForm = document.getElementById('upload-form');
  const uploadResult = document.getElementById('upload-result');

  uploadForm.addEventListener('submit', () => {
    uploadResult.innerHTML = "<p>Uploading... Please wait..</p>";
  });

  dropZone.addEventListener('click', () => {
    fileInput.click();
  });

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');

    const files = e.dataTransfer.files;
    const dataTransfer = new DataTransfer();

    for (let i = 0; i < files.length; i++) {
      dataTransfer.items.add(files[i]);
    }

    fileInput.files = dataTransfer.files;
    fileInput.dispatchEvent(new Event('change'));
    uploadForm.requestSubmit();
  });

  document.body.addEventListener('htmx:afterRequest', function (event) {
    const status = event.detail.xhr.status;
    const response = JSON.parse(event.detail.xhr.responseText);
    $('#modal .modal-title').text(status === 200 ? 'Success' : 'Error');
    $('#modal-message').text(response.message);
    $('#modal-status').text(`Statu Code: ${response.status_code}`);
    $('#modal').modal('show');
    uploadResult.innerHTML = "";
  });

</script>
