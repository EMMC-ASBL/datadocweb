{% extends datadoc_base_template %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-3">
      <div class="card">
        <div class="card-header">
          Filters
        </div>
        <div class="card-body">
          <div class="btn-group btn-group-sm" role="group">
            <div class="btn-group btn-group-sm" role="group">
              <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                Add
              </button>
              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                {% for item in filters.items %}
                <li><button id="btn-{{ item.id }}" data-criteria="{{ item.value }}" type="button" class="dropdown-item" onclick="onAdd(this)">
                  {{ item.text }}
                </button></li>
                {% endfor %}
              </ul>
            </div>
            <div class="btn-group btn-group-sm" role="group">
              <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                Remove
              </button>
              <ul class="dropdown-menu">
                {% for item in filters.selected %}
                <li><button type="button" class="dropdown-item" onclick="onRemove(this)">
                  {{ item.text }}
                </button></li>
                {% endfor %}
              </ul>
            </div>
            <button type="button" class="btn btn-light">Apply</button>
          </div>            
          <form id="search-filters">
            {% for item in filters.selected %}
              <div class="mt-1">
                <label for="{{ item.id }}" class="form-label form-text">{{ item.text }}</label>
                <select class="form-select form-select-sm" id="{{ item.id }}"
                        name="type"
                        data-criteria="{{ item.value }}">
                  {% for choice in item.choices %}
                    <option value="{{ choice.value }}">{{ choice.text }}</option>
                  {% endfor %}      
                </select>
              </div>              
            {% endfor %}
          </form>
        </div>
      </div>
    </div>
    <div class="col-9" style="padding-left: 0px;">
      <div class="card">
        <div class="card-header">
          Search results
        </div>
        <div class="card-body">

          {% if error %}
          <div id="search-error">
            <div style="margin-top: 10px; margin-bottom: 0px;"
                role="alert"
                class="alert alert-warning alert-dismissible fade show">
              <strong>Error!</strong> {{ error }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>
          {% elif query and table %}
          <div id="search-result" class="mt-3">
            <div class="text-nowrap" style="overflow-x: auto">
              <table id="result" class="table table-sm">
                <thead>
                  <tr>{% for col in table.cols %}<th>{{ col }}</th>{% endfor %}</tr>
                </thead>
                <tbody>
                  {% for row in table.rows %}
                  <tr>{% for cell in row %}<td {{ cell.attrs|safe }}>{% if cell.href %}{% include 'datadoc/components/link.html' with data=cell %}{% else %}{{ cell.text }}{% endif %}</td>{% endfor %}</tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% elif query %}
          <div id="search-result-none">
            <p>no results matched with your query</p>
          </div>
          {% endif %}

        </div>
      </div>
    </div>
  </div>

<div id="input-criteria" style="display:none">
  <div class="mt-1">
    <label for="{id}" class="form-label form-text">{label}</label>
    <select class="form-select form-select-sm" id="{id}" name="criteria"
            data-criteria="{criteria}">
    </select>
  </div>
</div>

</div>

{% endblock %}
{% block scripts %}
<script>

  function onAdd(btn) {
    let id = btn.id.split('-');
    let html = $('#input-criteria').html().replaceAll('{id}', id[1]);
    html = html.replace('{label}', $(btn).text().trim());
    html = html.replace('{criteria}', $(btn).data('criteria'));
    $('#search-filters').append(html);
  }

  function onRemove(btn) {
  }

  function onApply() {
  
  }

</script>
{% endblock %}
