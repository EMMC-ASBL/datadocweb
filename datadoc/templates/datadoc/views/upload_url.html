{% extends 'datadoc/base.html' %}

{% block content %}
{% include 'datadoc/components/header.html' %}
<div class="container">
  <div class="alert alert-info" role="alert">
    <p>
      Please provide a valid download URL to the data documentation file
      (e.g., "http://example.com/file"). The file should serve structured
      documentation and can be publicly accessible or private (with appropriate
      authentication).
    </p>
    <hr>
    <p class="mb-0">
      Accepted file types include CSV, JSON, YAML, and their respective variations.
      Example templates can be found
      <a href="/upload-file" target="_blank">here</a>
    </p>
  </div>
  <form id="url-form" method="post" hx-post="{% url 'upload_file_url' %}" hx-target="#processing"
        hx-swap="innerHTML">
    {% csrf_token %}
    <div class="input-group mb-3">
      <input id="url" type="text" class="form-control"
             placeholder="Paste file accesss URL here">
      <button class="btn btn-success" type="submit" id="btn-submit" disabled>Submit</button>
    </div>
  </form>
  <div id="processing" class="alert alert-warning" role="alert" style="display: none;">
    Processing request for documentation... Please wait..
  </div>
</div>

<div id="modal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="modal-message"></p>
        <p id="modal-status"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('url').addEventListener('input', function () {
      document.getElementById('btn-submit').disabled = !this.value;
  });

  document.addEventListener('htmx:beforeRequest', function () {
    $('#processing').show();
  });

  document.addEventListener('htmx:afterRequest', function (event) {
    const response = JSON.parse(event.detail.xhr.responseText);
    $('#processing').hide();
    $('#modal .modal-title').text(status === 200 ? 'Success' : 'Error');
    $('#modal-message').text(response.message);
    $('#modal-status').text(`Statu Code: ${response.status_code}`);
    $('#modal').modal('show');
  });
</script>
{% endblock %}